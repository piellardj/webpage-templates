var Page;!function(d){var a,e,t=d.ColorPicker||(d.ColorPicker={});function u(e,t,n){return Math.max(t,Math.min(n,e))}function l(e,t,n){return u(Math.round(e),t,n)}function s(e,t){return(e%t+t)%t}function n(e){e=e.toString(16).toUpperCase();return 2===e.length?e:"0"+e}(e=a=a||{}).parseHexa=function(e){return/^#[0-9a-fA-F]{6}$/.test(e)?e.toUpperCase():null},e.hsvToRgb=function(e){var t=e.h/60,n=e.s*e.v,r=n*(1-Math.abs(s(t,2)-1)),t=t<=1?{r:n,g:r,b:0}:t<=2?{r:r,g:n,b:0}:t<=3?{r:0,g:n,b:r}:t<=4?{r:0,g:r,b:n}:t<=5?{r:r,g:0,b:n}:{r:n,g:0,b:r},r=e.v-n;return t.r=l(255*(t.r+r),0,255),t.g=l(255*(t.g+r),0,255),t.b=l(255*(t.b+r),0,255),t},e.rgbToHsv=function(e){var t=e.r/255,n=e.g/255,e=e.b/255,r=Math.max(t,n,e),i=r-Math.min(t,n,e),o={h:0,s:0,v:r};return 0!=i&&(r===t?o.h=(n-e)/i%6*60:r===n?o.h=60*((e-t)/i+2):r===e&&(o.h=60*((t-n)/i+4))),0!==r&&(o.s=i/r),o.h=s(o.h,360),o},e.rgbToHex=function(e){return"#"+n(e.r)+n(e.g)+n(e.b)},e.hexToRgb=function(e){return{r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)}},Object.defineProperty(i.prototype,"value",{get:function(){var e=this.element.dataset.currentColor;if(e)return e;throw new Error("No current color on ColorPicker '".concat(this.id,"'."))},set:function(e){if(this.value!==e){this.element.dataset.currentColor=e,this.updateVisiblePart();for(var t=a.hexToRgb(e),n=0,r=this.observers;n<r.length;n++)(0,r[n])(t)}},enumerable:!1,configurable:!0}),i.prototype.updateVisiblePart=function(){var e=this.value;this.colorPreview.style.background=e,this.colorPreviewText.textContent=e};var r=i;function i(e){var t=this;this.observers=[],this.element=e,this.id=e.id,this.colorPreview=e.querySelector(".color-preview"),this.colorPreviewText=e.querySelector(".color-value"),this.updateVisiblePart(),this.element.addEventListener("click",function(){h.assignPopup(t)})}var o=new d.Helpers.Cache("ColorPicker",function(){return d.Helpers.Utils.selectorAll(document,".color-picker[id]").map(function(e){return new r(e)})}),p=new d.Helpers.Storage("color-picker",function(e){return e.value},function(e,t){e=o.getByIdSafe(e),t=a.parseHexa(t);return!(!e||!t||(e.value=t,0))}),h=(c.assignPopup=function(e){c.popup||(c.popup=new c),c.popup.attach(e)},c.prototype.updateAppearance=function(){var e=a.hsvToRgb(this.hsv),t=a.rgbToHex(e),n="rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")"),r="hsl(".concat(Math.round(this.hsv.h),", 100%, 50%)"),r=(this.hueColorFilter.style.background="linear-gradient(to right, white, ".concat(r,")"),this.hueCursor.style.background=r,this.valueSaturationCursor.style.background=n,this.previewColor.style.background=n,this.previewHexaValue.value=t.substring(1),this.previewRgbValue.textContent="".concat(e.r,", ").concat(e.g,", ").concat(e.b),c.percentageString(this.hsv.s)),n=c.percentageString(this.hsv.v);this.previewHslValue.textContent="".concat(Math.round(this.hsv.h),"Â°, ").concat(r,", ").concat(n),this.hueCursor.style.left=c.percentageString(this.hsv.h/360),this.valueSaturationCursor.style.left=r,this.valueSaturationCursor.style.top=c.percentageString(1-this.hsv.v)},c.prototype.onInput=function(){var e=a.hsvToRgb(this.hsv),e=a.rgbToHex(e);this.updateAppearance(),this.currentControl&&(this.currentControl.value=e),p.storeState(this.currentControl)},c.prototype.attach=function(e){e=(this.currentControl=e).value,e=a.hexToRgb(e),e=a.rgbToHsv(e);c.popup.hsv.h=e.h,c.popup.hsv.v=e.v,c.popup.hsv.s=e.s,c.popup.updateAppearance(),this.popupElement.style.top="",this.popupElement.style.left="",document.body.appendChild(this.popupElement),this.fitPopupToContainer()},c.prototype.fitPopupToContainer=function(){var e,t,n,r,i;this.popupElement.parentElement&&this.currentControl&&(t=this.currentControl.colorPreview.getBoundingClientRect(),e=this.popupElement.getBoundingClientRect(),n=t.left+window.scrollX,r=t=t.top+window.scrollY,0<(i=(n=n)+e.width-(document.body.clientWidth-8))&&(n-=i),0<(i=t+e.height-(window.scrollY+window.innerHeight-8))&&(r-=i),r=Math.max(window.scrollY+8,r),this.popupElement.style.left=n+"px",this.popupElement.style.top=r+"px")},c.prototype.registerCursorEvent=function(r,s){function p(e,t){var n=r.getBoundingClientRect(),e=(e-n.left)/n.width,t=(t-n.top)/n.height;return{x:Math.max(0,Math.min(1,e)),y:Math.max(0,Math.min(1,t))}}var n=r.querySelector(".cursor"),i={x:0,y:0},h=!1,c=(r.addEventListener("mousedown",function(e){var t;h=!0,i.x=0,i.y=0,n&&e.target===n?(t=n.getBoundingClientRect(),i.x=.5*t.width-(e.clientX-t.left),i.y=.5*t.height-(e.clientY-t.top)):(t=p(e.clientX,e.clientY),s(t))}),window.addEventListener("mouseup",function(){h=!1}),window.addEventListener("mousemove",function(e){h&&(e=p(e.clientX+i.x,e.clientY+i.y),s(e))}),[]);r.addEventListener("touchstart",function(e){h=!0;for(var t=0===c.length,e=d.Helpers.Utils.touchArray(e.changedTouches),n=0,r=e;n<r.length;n++){for(var i=r[n],o=!1,a=0,u=c;a<u.length;a++){var l=u[a];if(i.identifier===l){o=!0;break}}o||c.push(i.identifier)}t&&0<c.length&&((t=e[0])?(e=p(t.clientX,t.clientY),s(e)):console.error("Should not happen: ColorPicker missed first touch."))},!1),window.addEventListener("touchend",function(e){for(var t=0<c.length,n=0,r=d.Helpers.Utils.touchArray(e.changedTouches);n<r.length;n++)for(var i=r[n],o=0;o<c.length;++o)i.identifier===c[o]&&(c.splice(o,1),o--);t&&0===c.length&&(h=!1)}),window.addEventListener("touchmove",function(e){if(0<c.length&&h)for(var t=0,n=d.Helpers.Utils.touchArray(e.changedTouches);t<n.length;t++)for(var r=n[t],i=0,o=c;i<o.length;i++){var a=o[i];if(r.identifier===a)return a=p(r.clientX,r.clientY),s(a),void e.preventDefault()}},{passive:!1})},c.buildElement=function(e,t){e=document.createElement(e);return t&&(e.className=t.join(" ")),e},c.buildPreviewText=function(e,t){var n=document.createElement("tr"),r=document.createElement("td"),t=(r.textContent=t+":",document.createElement("td"));return n.appendChild(r),n.appendChild(t),e.appendChild(n),t},c.percentageString=function(e){return Math.round(100*e)+"%"},c);function c(){var t=this,e=(this.hsv={h:200,s:.75,v:.5},this.popupElement=c.buildElement("div",["popup","color-picker-popup"]),this.valueSaturationPicker=c.buildElement("div",["block","picker","value-saturation-picker"]),this.hueColorFilter=c.buildElement("span",["color-filter","outlined"]),this.valueSaturationPicker.appendChild(this.hueColorFilter),c.buildElement("span",["color-filter","outlined"])),e=(e.style.background="linear-gradient(to top, black, rgba(0,0,0,0))",this.valueSaturationPicker.appendChild(e),this.valueSaturationCursor=c.buildElement("span",["cursor"]),this.valueSaturationPicker.appendChild(this.valueSaturationCursor),this.popupElement.appendChild(this.valueSaturationPicker),this.huePicker=c.buildElement("div",["block","picker","hue-picker"]),c.buildElement("span",["hue-bar"])),e=(this.huePicker.appendChild(e),this.hueCursor=c.buildElement("span",["cursor"]),this.huePicker.appendChild(this.hueCursor),this.popupElement.appendChild(this.huePicker),c.buildElement("div",["preview-block"])),n=(this.previewColor=c.buildElement("div",["preview-color","outlined"]),this.previewColor.classList.add("block"),e.appendChild(this.previewColor),c.buildElement("table",["block"])),r=c.buildPreviewText(n,"hexa"),i=c.buildElement("span"),o=(i.textContent="#",r.appendChild(i),this.previewHexaValue=document.createElement("input"),this.previewHexaValue.type="text",this.previewHexaValue.minLength=6,this.previewHexaValue.maxLength=6,this.previewHexaValue.size=6,this.previewHexaValue.pattern="[0-9a-fA-F]{6}",this.previewHexaValue.addEventListener("input",function(){var e="#"+t.previewHexaValue.value;a.parseHexa(e)&&(e=a.hexToRgb(e),e=a.rgbToHsv(e),t.hsv.h=e.h,t.hsv.s=e.s,t.hsv.v=e.v,t.onInput())}),r.appendChild(this.previewHexaValue),this.previewRgbValue=c.buildPreviewText(n,"rgb"),this.previewHslValue=c.buildPreviewText(n,"hsv"),e.appendChild(n),this.popupElement.appendChild(e),this.registerCursorEvent(this.huePicker,function(e){t.hsv.h=l(360*e.x,0,360),t.onInput()}),this.registerCursorEvent(this.valueSaturationPicker,function(e){t.hsv.s=u(e.x,0,1),t.hsv.v=u(1-e.y,0,1),t.onInput(),t.valueSaturationCursor.style.left=c.percentageString(e.x),t.valueSaturationCursor.style.top=c.percentageString(e.y)}),!1);this.popupElement.addEventListener("mousedown",function(){o=!0}),window.addEventListener("mouseup",function(e){t.popupElement.contains(e.target)||!t.popupElement.parentElement||o||t.popupElement.parentElement.removeChild(t.popupElement),o=!1}),window.addEventListener("resize",function(){t.fitPopupToContainer()}),window.addEventListener("scroll",function(){t.fitPopupToContainer()})}d.Helpers.Events.callAfterDOMLoaded(function(){o.load(),p.applyStoredState()}),t.addObserver=function(e,t){o.getById(e).observers.push(t)},t.getValue=function(e){return e=o.getById(e).value,a.hexToRgb(e)},t.getValueHex=function(e){return o.getById(e).value},t.setValue=function(e,t,n,r){t={r:l(t,0,255),g:l(n,0,255),b:l(r,0,255)},n=a.rgbToHex(t),o.getById(e).value=n},t.storeState=function(e){e=o.getById(e),p.storeState(e)},t.clearStoredState=function(e){e=o.getById(e),p.clearStoredState(e)}}(Page=Page||{});