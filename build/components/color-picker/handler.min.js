var Page;!function(e){var a,t,n=e.ColorPicker||(e.ColorPicker={});function u(e,t,n){return Math.max(t,Math.min(n,e))}function l(e,t,n){return u(Math.round(e),t,n)}function s(e,t){return(e%t+t)%t}function r(e){e=e.toString(16).toUpperCase();return 2===e.length?e:"0"+e}(t=a=a||{}).parseHexa=function(e){return/^#[0-9a-fA-F]{6}$/.test(e)?e.toUpperCase():null},t.hsvToRgb=function(e){var t=e.h/60,n=e.s*e.v,r=n*(1-Math.abs(s(t,2)-1)),t=t<=1?{r:n,g:r,b:0}:t<=2?{r:r,g:n,b:0}:t<=3?{r:0,g:n,b:r}:t<=4?{r:0,g:r,b:n}:t<=5?{r:r,g:0,b:n}:{r:n,g:0,b:r},r=e.v-n;return t.r=l(255*(t.r+r),0,255),t.g=l(255*(t.g+r),0,255),t.b=l(255*(t.b+r),0,255),t},t.rgbToHsv=function(e){var t=e.r/255,n=e.g/255,e=e.b/255,r=Math.max(t,n,e),i=r-Math.min(t,n,e),o={h:0,s:0,v:r};return 0!=i&&(r===t?o.h=(n-e)/i%6*60:r===n?o.h=60*((e-t)/i+2):r===e&&(o.h=60*((t-n)/i+4))),0!==r&&(o.s=i/r),o.h=s(o.h,360),o},t.rgbToHex=function(e){return"#"+r(e.r)+r(e.g)+r(e.b)},t.hexToRgb=function(e){return{r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)}},Object.defineProperty(o.prototype,"value",{get:function(){return this.element.dataset.currentColor},set:function(e){if(this.value!==e){this.element.dataset.currentColor=e,this.updateVisiblePart();for(var t=a.hexToRgb(e),n=0,r=this.observers;n<r.length;n++)(0,r[n])(t)}},enumerable:!1,configurable:!0}),o.prototype.attachPopup=function(e){this.element.parentElement.appendChild(e)},o.prototype.updateVisiblePart=function(){var e=this.value;this.colorPreview.style.background=e,this.colorPreviewText.textContent=e};var i=o;function o(e){var t=this;this.observers=[],this.element=e,this.id=e.id,this.colorPreview=e.querySelector(".color-preview"),this.colorPreviewText=e.querySelector(".color-value"),this.updateVisiblePart(),this.element.addEventListener("click",function(){c.assignPopup(t)})}var p=new e.Helpers.Cache("ColorPicker",function(){for(var e=[],t=document.querySelectorAll(".color-picker[id]"),n=0;n<t.length;n++){var r=new i(t[n]);e.push(r)}return e}),h=new e.Helpers.Storage("color-picker",function(e){return e.value},function(e,t){e=p.getByIdSafe(e),t=a.parseHexa(t);return!(!e||!t)&&(e.value=t,!0)}),c=(d.assignPopup=function(e){d.popup||(d.popup=new d),d.popup.attach(e)},d.prototype.updateAppearance=function(){var e=a.hsvToRgb(this.hsv),t=a.rgbToHex(e),n="rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")"),r="hsl(".concat(Math.round(this.hsv.h),", 100%, 50%)"),r=(this.hueColorFilter.style.background="linear-gradient(to right, white, ".concat(r,")"),this.hueCursor.style.background=r,this.valueSaturationCursor.style.background=n,this.previewColor.style.background=n,this.previewHexaValue.value=t.substring(1),this.previewRgbValue.textContent="".concat(e.r,", ").concat(e.g,", ").concat(e.b),d.percentageString(this.hsv.s)),n=d.percentageString(this.hsv.v);this.previewHslValue.textContent="".concat(Math.round(this.hsv.h),"Â°, ").concat(r,", ").concat(n),this.hueCursor.style.left=d.percentageString(this.hsv.h/360),this.valueSaturationCursor.style.left=r,this.valueSaturationCursor.style.top=d.percentageString(1-this.hsv.v)},d.prototype.onInput=function(){var e=a.hsvToRgb(this.hsv),e=a.rgbToHex(e);this.updateAppearance(),this.currentControl&&(this.currentControl.value=e),h.storeState(this.currentControl)},d.prototype.attach=function(e){e=(this.currentControl=e).value,e=a.hexToRgb(e),e=a.rgbToHsv(e);d.popup.hsv.h=e.h,d.popup.hsv.v=e.v,d.popup.hsv.s=e.s,d.popup.updateAppearance(),this.popupElement.style.top="",this.popupElement.style.left="",this.currentControl.attachPopup(this.popupElement),this.fitPopupToContainer()},d.prototype.fitPopupToContainer=function(){var e,t,n,r,i,o;this.popupElement.parentElement&&(r=(i=(document.querySelector(".controls-block")||document.body).getBoundingClientRect()).left+i.width-16,o=i.top+i.height-16,this.popupElement.style.maxWidth=i.width-32+"px",this.popupElement.style.maxHeight=i.height-32+"px",e=this.popupElement.parentElement.getBoundingClientRect(),t=this.popupElement.getBoundingClientRect(),n=Math.max(0,i.left+16-e.left),r=Math.min(0,r-(e.left+t.width)),i=Math.max(0,i.top+16-e.top),o=Math.min(0,o-(e.top+t.height)),this.popupElement.style.left=n+r+"px",this.popupElement.style.top=i+o+"px")},d.prototype.registerCursorEvent=function(r,l){function s(e,t){var n=r.getBoundingClientRect(),e=(e-n.left)/n.width,t=(t-n.top)/n.height;return{x:Math.max(0,Math.min(1,e)),y:Math.max(0,Math.min(1,t))}}var n=r.querySelector(".cursor"),i={x:0,y:0},p=!1,h=(r.addEventListener("mousedown",function(e){var t;p=!0,i.x=0,i.y=0,n&&e.target===n?(t=n.getBoundingClientRect(),i.x=.5*t.width-(e.clientX-t.left),i.y=.5*t.height-(e.clientY-t.top)):(t=s(e.clientX,e.clientY),l(t))}),window.addEventListener("mouseup",function(){p=!1}),window.addEventListener("mousemove",function(e){p&&(e=s(e.clientX+i.x,e.clientY+i.y),l(e))}),[]);r.addEventListener("touchstart",function(e){p=!0;for(var t=0===h.length,n=0;n<e.changedTouches.length;++n){for(var r=e.changedTouches[n],i=!1,o=0,a=h;o<a.length;o++){var u=a[o];if(r.identifier===u){i=!0;break}}i||h.push(r.identifier)}t&&0<h.length&&(t=s(e.changedTouches[0].clientX,e.changedTouches[0].clientY),l(t))},!1),window.addEventListener("touchend",function(e){for(var t=0<h.length,n=0;n<e.changedTouches.length;++n)for(var r=e.changedTouches[n],i=0;i<h.length;++i)r.identifier===h[i]&&(h.splice(i,1),i--);t&&0===h.length&&(p=!1)}),window.addEventListener("touchmove",function(e){if(0<h.length&&p)for(var t=e.changedTouches,n=0;n<t.length;++n)for(var r=t[n],i=0,o=h;i<o.length;i++){var a=o[i];if(r.identifier===a)return a=s(r.clientX,r.clientY),l(a),void e.preventDefault()}},{passive:!1})},d.buildElement=function(e,t){e=document.createElement(e);return t&&(e.className=t.join(" ")),e},d.buildPreviewText=function(e,t){var n=document.createElement("tr"),r=document.createElement("td"),t=(r.textContent=t+":",document.createElement("td"));return n.appendChild(r),n.appendChild(t),e.appendChild(n),t},d.percentageString=function(e){return Math.round(100*e)+"%"},d);function d(){var t=this,e=(this.hsv={h:200,s:.75,v:.5},this.popupElement=d.buildElement("div",["popup","color-picker-popup"]),this.valueSaturationPicker=d.buildElement("div",["block","picker","value-saturation-picker"]),this.hueColorFilter=d.buildElement("span",["color-filter","outlined"]),this.valueSaturationPicker.appendChild(this.hueColorFilter),d.buildElement("span",["color-filter","outlined"])),e=(e.style.background="linear-gradient(to top, black, rgba(0,0,0,0))",this.valueSaturationPicker.appendChild(e),this.valueSaturationCursor=d.buildElement("span",["cursor"]),this.valueSaturationPicker.appendChild(this.valueSaturationCursor),this.popupElement.appendChild(this.valueSaturationPicker),this.huePicker=d.buildElement("div",["block","picker","hue-picker"]),d.buildElement("span",["hue-bar"])),e=(this.huePicker.appendChild(e),this.hueCursor=d.buildElement("span",["cursor"]),this.huePicker.appendChild(this.hueCursor),this.popupElement.appendChild(this.huePicker),d.buildElement("div",["preview-block"])),n=(this.previewColor=d.buildElement("div",["preview-color","outlined"]),this.previewColor.classList.add("block"),e.appendChild(this.previewColor),d.buildElement("table",["block"])),r=d.buildPreviewText(n,"hexa"),i=d.buildElement("span"),o=(i.textContent="#",r.appendChild(i),this.previewHexaValue=document.createElement("input"),this.previewHexaValue.type="text",this.previewHexaValue.minLength=6,this.previewHexaValue.maxLength=6,this.previewHexaValue.size=6,this.previewHexaValue.pattern="[0-9a-fA-F]{6}",this.previewHexaValue.addEventListener("input",function(){var e="#"+t.previewHexaValue.value;a.parseHexa(e)&&(e=a.hexToRgb(e),e=a.rgbToHsv(e),t.hsv.h=e.h,t.hsv.s=e.s,t.hsv.v=e.v,t.onInput())}),r.appendChild(this.previewHexaValue),this.previewRgbValue=d.buildPreviewText(n,"rgb"),this.previewHslValue=d.buildPreviewText(n,"hsv"),e.appendChild(n),this.popupElement.appendChild(e),this.registerCursorEvent(this.huePicker,function(e){t.hsv.h=l(360*e.x,0,360),t.onInput()}),this.registerCursorEvent(this.valueSaturationPicker,function(e){t.hsv.s=u(e.x,0,1),t.hsv.v=u(1-e.y,0,1),t.onInput(),t.valueSaturationCursor.style.left=d.percentageString(e.x),t.valueSaturationCursor.style.top=d.percentageString(e.y)}),!1);this.popupElement.addEventListener("mousedown",function(){o=!0}),window.addEventListener("mouseup",function(e){t.popupElement.contains(e.target)||!t.popupElement.parentElement||o||t.popupElement.parentElement.removeChild(t.popupElement),o=!1})}e.Helpers.Events.callAfterDOMLoaded(function(){p.load(),h.applyStoredState()}),n.addObserver=function(e,t){p.getById(e).observers.push(t)},n.getValue=function(e){return e=p.getById(e).value,a.hexToRgb(e)},n.getValueHex=function(e){return p.getById(e).value},n.setValue=function(e,t,n,r){t={r:l(t,0,255),g:l(n,0,255),b:l(r,0,255)},n=a.rgbToHex(t),p.getById(e).value=n},n.storeState=function(e){e=p.getById(e),h.storeState(e)},n.clearStoredState=function(e){e=p.getById(e),h.clearStoredState(e)}}(Page=Page||{});