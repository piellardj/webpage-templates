var Page;!function(e){!function(n){function t(e){var n=document.querySelector(e);return n||console.error("Cannot find element '"+e+"'."),n}function i(e){return t("input[type=checkbox][id="+e+"]")}var o=document.getElementById("canvas-container"),r=t("canvas[id="+"canvas"+"]"),c=document.getElementById("canvas-buttons-column"),a=i("fullscreen-checkbox-id"),u=i("side-pane-checkbox-id"),s=o.querySelector(".loader"),l=512,d=512;function f(){var e=r.getBoundingClientRect();return[Math.floor(e.width),Math.floor(e.height)]}!function(){function n(e){document.body.style.overflow=e?"hidden":"auto"}a&&(e.Helpers.Events.callAfterDOMLoaded(function(){n(a.checked),a.addEventListener("change",function(){n(a.checked)})}),u&&a.addEventListener("change",function(){a.checked&&(u.checked=!1)},!1))}();var v=[0,0],h=[];function g(e){return e+"px"}function m(){o.style.width="100vw";var e=f();if(a.checked?(o.style.height="100%",o.style.maxWidth="",o.style.maxHeight=""):(e[1]=e[0]*d/l,o.style.height=g(e[1]),o.style.maxWidth=g(l),o.style.maxHeight=g(d)),e[0]!==v[0]||e[1]!==v[1]){v=f();for(var n=0,t=h;n<t.length;n++){(0,t[n])(v[0],v[1])}}}e.Helpers.Events.callAfterDOMLoaded(m),a.addEventListener("change",m,!1),window.addEventListener("resize",m,!1);var p,y,E,w,L=[m],k=[],M=[],C=[],b=[],S=[],Y=[],x=[];function X(e,n){var t=r.getBoundingClientRect();return[(e-t.left)/t.width,(n-t.top)/t.height]}a&&a.addEventListener("change",function(){for(var e=a.checked,n=0,t=L;n<t.length;n++){(0,t[n])(e)}},!1),document.addEventListener("keydown",function(e){27===e.keyCode&&n.toggleFullscreen(!1)}),function(e){var n=[],t=[0,0],i=!1;function o(e,t){n[0]=e,n[1]=t}function c(e,n){var t=X(e,n);o(t[0],t[1]),i=!0;for(var r=0,c=k;r<c.length;r++){(0,c[r])()}}function a(){if(i){i=!1;for(var e=0,n=M;e<n.length;e++){(0,n[e])()}}}function u(e,o){t[0]=e,t[1]=o;var r=X(e,o),c=r[0]-n[0],a=r[1]-n[1];if(n[0]=r[0],n[1]=r[1],i)for(var u=0,s=C;u<s.length;u++){(0,s[u])(c,a)}for(var l=0,d=b;l<d.length;l++){(0,d[l])(r[0],r[1])}}e.getMousePosition=function(){return n.slice()},e.setMousePosition=o,e.isMouseDown=function(){return i},e.mouseDown=c,e.mouseUp=a,e.mouseMove=u,r&&(r.addEventListener("mousedown",function(e){0===e.button&&c(e.clientX,e.clientY)},!1),r.addEventListener("mouseenter",function(){for(var e=0,n=S;e<n.length;e++){(0,n[e])()}},!1),r.addEventListener("mouseleave",function(){for(var e=0,n=Y;e<n.length;e++){(0,n[e])()}},!1),r.addEventListener("wheel",function(e){if(x.length>0){for(var t=e.deltaY>0?1:-1,i=0,o=x;i<o.length;i++){(0,o[i])(t,n)}return e.preventDefault(),!1}return!0},!1),window.addEventListener("mousemove",function(e){u(e.clientX,e.clientY)}),window.addEventListener("mouseup",function(e){0===e.button&&a()}),h.push(function(){u(t[0],t[1])}))}(p||(p={})),function(e){var n=[],t=0;function i(e,n){var t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}r&&(r.addEventListener("touchstart",function(e){for(var o=0===n.length,r=0;r<e.changedTouches.length;++r){for(var c=e.changedTouches[r],a=!1,u=0,s=n;u<s.length;u++){var l=s[u];if(c.identifier===l.id){a=!0;break}}a||n.push({id:c.identifier,clientX:c.clientX,clientY:c.clientY})}if(o&&n.length>0){var d=n[0];p.mouseDown(d.clientX,d.clientY)}else 2===n.length&&(t=i(n[0],n[1]))},!1),window.addEventListener("touchend",function(e){for(var t=n.length>0,i=0;i<e.changedTouches.length;++i)for(var o=e.changedTouches[i],r=0;r<n.length;++r)o.identifier===n[r].id&&(n.splice(r,1),r--);if(1===n.length){var c=X(n[0].clientX,n[0].clientY);p.setMousePosition(c[0],c[1])}else t&&0===n.length&&p.mouseUp()}),window.addEventListener("touchmove",function(e){for(var o=e.changedTouches,r=0;r<o.length;++r)for(var c=o[r],a=0,u=n;a<u.length;a++){var s=u[a];c.identifier===s.id&&(s.clientX=c.clientX,s.clientY=c.clientY)}var l=b.length+C.length;if(p.isMouseDown()&&l>0&&e.preventDefault(),1===n.length)p.mouseMove(n[0].clientX,n[0].clientY);else if(2===n.length){var d=i(n[0],n[1]),f=(t-d)/t;t=d;for(var v=X(.5*(n[0].clientX+n[1].clientX),.5*(n[0].clientY+n[1].clientY)),h=0,g=x;h<g.length;h++)(0,g[h])(5*f,v)}},{passive:!1}))}(y||(y={})),function(e){var n={},i="-indicator-id";e.getIndicator=function(e){return t("#"+e+i)},e.getIndicatorSpan=function(e){if(!n[e]){var o=e+i;n[e]=t("#"+o+" span")}return n[e]}}(E||(E={})),function(n){var t="canvas",i="fullscreen",o="sidepane",r="true",c="false";function s(n,i){var o=i?r:c;e.Helpers.URL.setQueryParameter(t,n,o)}n.attachStorageEvents=function(){a&&a.addEventListener("change",function(){s(i,a.checked),e.Helpers.URL.removeQueryParameter(t,o)}),u&&u.addEventListener("change",function(){s(o,u.checked)})},n.applyStoredState=function(){e.Helpers.URL.loopOnParameters(t,function(n,s){n!==i||s!==r&&s!==c?n!==o||s!==r&&s!==c?(console.log("Removing invalid query parameter '"+n+"="+s+"'."),e.Helpers.URL.removeQueryParameter(t,n)):u&&(u.checked=s===r):a&&(a.checked=s===r)})}}(w||(w={})),w.applyStoredState(),w.attachStorageEvents(),n.Observers=Object.freeze({canvasResize:h,fullscreenToggle:L,mouseDown:k,mouseDrag:C,mouseEnter:S,mouseLeave:Y,mouseMove:b,mouseWheel:x,mouseUp:M}),n.getAspectRatio=function(){var e=f();return e[0]/e[1]},n.getCanvas=function(){return r},n.getCanvasContainer=function(){return o},n.getSize=function(){return f()},n.getMousePosition=function(){return p.getMousePosition()},n.isFullScreen=function(){return a&&a.checked},n.isMouseDown=function(){return p.isMouseDown()},n.setIndicatorText=function(e,n){var t=E.getIndicatorSpan(e);t&&(t.innerText=n)},n.setIndicatorVisibility=function(e,n){var t=E.getIndicator(e);t&&(t.style.display=n?"":"none")},n.setIndicatorsVisibility=function(e){document.getElementById("indicators").style.display=e?"":"none"},n.setMaxSize=function(e,n){l=e,d=n,m()},n.setResizable=function(e){c.style.display=e?"":"none"},n.setLoaderText=function(e){s&&(s.querySelector("span").innerText=e)},n.showLoader=function(e){s&&(s.style.display=e?"block":"")},n.toggleFullscreen=function(e){if(a&&e!==a.checked)if(a.checked=e,"function"==typeof window.CustomEvent)a.dispatchEvent(new CustomEvent("change"));else if("function"==typeof CustomEvent.prototype.initCustomEvent){var n=document.createEvent("CustomEvent");n.initCustomEvent("change",!1,!1,void 0),a.dispatchEvent(n)}}}(e.Canvas||(e.Canvas={}))}(Page||(Page={}));