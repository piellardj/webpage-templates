var Page;!function(J){!function(n){function t(e){var n=document.querySelector(e);return n||console.error("Cannot find element '"+e+"'."),n}function e(e){return t("input[type=checkbox][id="+e+"]")}var o=document.getElementById("canvas-container"),i=t("canvas[id=canvas]"),c=document.getElementById("canvas-buttons-column"),r=e("fullscreen-checkbox-id"),a=e("side-pane-checkbox-id"),u=o.querySelector(".loader"),s=512,l=512;function d(e){document.body.style.overflow=e?"hidden":"auto"}function f(){var e=i.getBoundingClientRect();return[Math.floor(e.width),Math.floor(e.height)]}r&&(J.Helpers.Events.callAfterDOMLoaded(function(){d(r.checked),r.addEventListener("change",function(){d(r.checked)})}),a&&r.addEventListener("change",function(){r.checked&&(a.checked=!1)},!1));var h=[0,0],v=[];function g(e){return e+"px"}function m(){o.style.width="100vw";var e=f();if(r.checked?(o.style.height="100%",o.style.maxWidth="",o.style.maxHeight=""):(e[1]=e[0]*l/s,o.style.height=g(e[1]),o.style.maxWidth=g(s),o.style.maxHeight=g(l)),e[0]!==h[0]||e[1]!==h[1]){h=f();for(var n=0,t=v;n<t.length;n++)(0,t[n])(h[0],h[1])}}J.Helpers.Events.callAfterDOMLoaded(m),r.addEventListener("change",m,!1),window.addEventListener("resize",m,!1);var p,y,E,w,L,k,M,C,b,S,Y,x,X,D,P,I,R=[m],T=[],H=[],U=[],z=[],q=[],B=[],O=[];function A(e,n){var t=i.getBoundingClientRect();return[(e-t.left)/t.width,(n-t.top)/t.height]}function F(e,n){y[0]=e,y[1]=n}function Q(e,n){n=A(e,n);F(n[0],n[1]),w=!0;for(var t=0,o=T;t<o.length;t++)(0,o[t])()}function W(){if(w){w=!1;for(var e=0,n=H;e<n.length;e++)(0,n[e])()}}function V(e,n){var t=A(E[0]=e,E[1]=n),o=t[0]-y[0],i=t[1]-y[1];if(y[0]=t[0],y[1]=t[1],w)for(var c=0,r=U;c<r.length;c++)(0,r[c])(o,i);for(var a=0,u=z;a<u.length;a++)(0,u[a])(t[0],t[1])}function j(e,n){var t=e.clientX-n.clientX,n=e.clientY-n.clientY;return Math.sqrt(t*t+n*n)}function G(e,n){J.Helpers.URL.setQueryParameter(x,e,n?P:I)}r&&r.addEventListener("change",function(){for(var e=r.checked,n=0,t=R;n<t.length;n++)(0,t[n])(e)},!1),document.addEventListener("keydown",function(e){27===e.keyCode&&n.toggleFullscreen(!1)}),Y=p=p||{},y=[0,0],w=!(E=[0,0]),Y.getMousePosition=function(){return[y[0],y[1]]},Y.setMousePosition=F,Y.isMouseDown=function(){return w},Y.mouseDown=Q,Y.mouseUp=W,Y.mouseMove=V,i&&(i.addEventListener("mousedown",function(e){0===e.button&&Q(e.clientX,e.clientY)},!1),i.addEventListener("mouseenter",function(){for(var e=0,n=q;e<n.length;e++)(0,n[e])()},!1),i.addEventListener("mouseleave",function(){for(var e=0,n=B;e<n.length;e++)(0,n[e])()},!1),i.addEventListener("wheel",function(e){if(0<O.length){for(var n=0<e.deltaY?1:-1,t=0,o=O;t<o.length;t++)(0,o[t])(n,y);return e.preventDefault(),!1}return!0},!1),window.addEventListener("mousemove",function(e){V(e.clientX,e.clientY)}),window.addEventListener("mouseup",function(e){0===e.button&&W()}),v.push(function(){V(E[0],E[1])})),L=[],k=0,i&&(i.addEventListener("touchstart",function(e){for(var n=0===L.length,t=0;t<e.changedTouches.length;++t){for(var o=e.changedTouches[t],i=!1,c=0,r=L;c<r.length;c++){var a=r[c];if(o.identifier===a.id){i=!0;break}}i||L.push({id:o.identifier,clientX:o.clientX,clientY:o.clientY})}n&&0<L.length?(n=L[0],p.mouseDown(n.clientX,n.clientY)):2===L.length&&(k=j(L[0],L[1]))},!1),window.addEventListener("touchend",function(e){for(var n,t=0<L.length,o=0;o<e.changedTouches.length;++o)for(var i=e.changedTouches[o],c=0;c<L.length;++c)i.identifier===L[c].id&&(L.splice(c,1),c--);1===L.length?(n=A(L[0].clientX,L[0].clientY),p.setMousePosition(n[0],n[1])):t&&0===L.length&&p.mouseUp()}),window.addEventListener("touchmove",function(e){for(var n=e.changedTouches,t=0;t<n.length;++t)for(var o=n[t],i=0,c=L;i<c.length;i++){var r=c[i];o.identifier===r.id&&(r.clientX=o.clientX,r.clientY=o.clientY)}var a=z.length+U.length;if(p.isMouseDown()&&0<a&&e.preventDefault(),1===L.length)p.mouseMove(L[0].clientX,L[0].clientY);else if(2===L.length){var e=j(L[0],L[1]),u=(k-e)/k;k=e;for(var s=A(.5*(L[0].clientX+L[1].clientX),.5*(L[0].clientY+L[1].clientY)),l=0,d=O;l<d.length;l++)(0,d[l])(5*u,s)}},{passive:!1})),Y=M=M||{},C={},b="-indicator-id",Y.getIndicator=function(e){return t("#"+e+b)},Y.getIndicatorSpan=function(e){return C[e]||(C[e]=t("#"+(e+b)+" span")),C[e]},Y=S=S||{},x="canvas",X="fullscreen",D="sidepane",P="true",I="false",Y.attachStorageEvents=function(){r&&r.addEventListener("change",function(){G(X,r.checked),J.Helpers.URL.removeQueryParameter(x,D)}),a&&a.addEventListener("change",function(){G(D,a.checked)})},Y.applyStoredState=function(){J.Helpers.URL.loopOnParameters(x,function(e,n){e!==X||n!==P&&n!==I?e!==D||n!==P&&n!==I?(console.log("Removing invalid query parameter '"+e+"="+n+"'."),J.Helpers.URL.removeQueryParameter(x,e)):a&&(a.checked=n===P):r&&(r.checked=n===P)})},S.applyStoredState(),S.attachStorageEvents(),n.Observers=Object.freeze({canvasResize:v,fullscreenToggle:R,mouseDown:T,mouseDrag:U,mouseEnter:q,mouseLeave:B,mouseMove:z,mouseWheel:O,mouseUp:H}),n.getAspectRatio=function(){var e=f();return e[0]/e[1]},n.getCanvas=function(){return i},n.getCanvasContainer=function(){return o},n.getSize=f,n.getMousePosition=function(){return p.getMousePosition()},n.isFullScreen=function(){return r&&r.checked},n.isMouseDown=function(){return p.isMouseDown()},n.setIndicatorText=function(e,n){(e=M.getIndicatorSpan(e))&&(e.innerText=n)},n.setIndicatorVisibility=function(e,n){(e=M.getIndicator(e))&&(e.style.display=n?"":"none")},n.setIndicatorsVisibility=function(e){document.getElementById("indicators").style.display=e?"":"none"},n.setMaxSize=function(e,n){s=e,l=n,m()},n.setResizable=function(e){c.style.display=e?"":"none"},n.setLoaderText=function(e){u&&(u.querySelector("span").innerText=e)},n.showLoader=function(e){u&&(u.style.display=e?"block":"")},n.toggleFullscreen=function(e){r&&e!==r.checked&&(r.checked=e,"function"==typeof window.CustomEvent?r.dispatchEvent(new CustomEvent("change")):"function"==typeof CustomEvent.prototype.initCustomEvent&&((e=document.createEvent("CustomEvent")).initCustomEvent("change",!1,!1,void 0),r.dispatchEvent(e)))}}(J.Canvas||(J.Canvas={}))}(Page=Page||{});